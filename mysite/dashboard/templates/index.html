<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>만개의 레시피 재료 분석</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lumen/bootstrap.min.css" />
    <!-- Chart Js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- WordCloud -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container px-4 px-lg-5">
        <span class="navbar-title">만개의 레시피 재료 분석</span>
      </div>
    </nav>
    <style>
      .navbar-title {
          font-size: 32px;
          font-weight: bold;
          color: #090;
          text-align: center;
      }
    </style>
    <section class="py-5">
      <div class="container px-4 px-lg-5 my-5">
        <div class="row gx-4 gx-lg-5 align-items-center">
          <div class="col-md-8">
            <canvas id="myChart" width="400" height="200"></canvas>
            <script>
              const ctx = document.getElementById('myChart').getContext('2d');
              const myChart = new Chart(ctx, {
                  type: 'bar',
                  data: {
                      labels: {{ labels_json|safe }},
                      datasets: [{
                          label: '많이 사용된 재료들!',
                          data: {{ data_json|safe }},
                          backgroundColor: 'rgba(75, 192, 192, 0.2)',
                          borderColor: 'rgba(75, 192, 192, 1)',
                          borderWidth: 1
                      }]
                  },
                  options: {
                      scales: {
                          y: {
                              beginAtZero: true
                          }
                      }
                  }
              });
            </script>

	<canvas id="piChart" width="400" height="200"></canvas>
            <script>
        const ctx2 = document.getElementById('piChart').getContext('2d');
        const piChart = new Chart(ctx2, {
          type: 'doughnut',
          data: {
            labels: {{ cook_time_label|safe }},
            datasets: [{
              label: '조리 소요 시간',
              data: {{ cook_time_data|safe }},
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                      ],
              borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                            borderWidth: 1
            }]
          },
          options: {
            plugins: {
                  title: {
                      display: true, // 제목을 표시하기 위해 필수
                      text: "요리 소요 시간" // 제목 텍스트
                  }
              },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      </script>

      <div id="wordcloud" style="height: 300px; width: 100%; margin-top: 20px; border: 1px solid #000;"></div>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ingredients = {{ ingredients_json|safe }};
            
            // 빈도수의 최대값과 최소값을 찾습니다
            const frequencies = ingredients.map(ing => ing.frequency);
            const maxFreq = Math.max(...frequencies);
            const minFreq = Math.min(...frequencies);
            
            // 선형 스케일링 함수를 정의합니다
            const linearScale = (val, minVal, maxVal, newMin, newMax) => {
                return newMin + (val - minVal) * (newMax - newMin) / (maxVal - minVal);
            };
            
            // 단어 목록을 생성하고 빈도를 스케일링합니다
            const words = ingredients.map(ingredient => [
                ingredient.name,
                Math.max(10, Math.floor(linearScale(ingredient.frequency, minFreq, maxFreq, 10, 100)))
            ]);
  
            console.log("Words for WordCloud:", words); // 디버깅을 위해 콘솔에 출력
  
            // WordCloud2.js 라이브러리를 사용하여 워드 클라우드 생성
            WordCloud(document.getElementById('wordcloud'), {
                list: words,
                gridSize: 16,
                weightFactor: 1,
                fontFamily: 'Noto Sans KR, sans-serif',
                color: function(word, weight) {
                    return weight > 80 ? '#f02222' : weight > 40 ? '#c09292' : '#b8b8b8';
                },
                backgroundColor: 'white',
                rotateRatio: 0.5,
                rotationSteps: 2,
                drawOutOfBound: false,
                shrinkToFit: true,
                minSize: 10
            });
        });
      </script>
          
          </div>
          <div class="col-md-3" style="height: 1200px; overflow-y: auto; position: relative;">
            <h2 class="text-center mb-4" style="position: sticky; top: 0; background-color: white; z-index: 10;">레시피 랭킹</h2>
            {% for recipe in recipes %}
                <div class="small mb-1" style="font-weight: bold; font-size: 1.25rem;">
                    {{ forloop.counter }}위: {{ recipe.recipe_title }}
                </div>
                <div class="text-center">
                    <img src="{{ recipe.image_url }}" alt="{{ recipe.recipe_title }}" style="width: 60%; height: auto;">
                </div>
                <hr />
            {% endfor %}
          </div>
        </div>
      </div>
    </section>
    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p>
      </div>
    </footer>
  </body>
</html>