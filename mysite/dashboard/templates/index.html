<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>만개의 레시피 재료 분석</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lumen/bootstrap.min.css" />
    <!-- Chart Js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- WordCloud -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    
    {% block navbar %}
    {% include 'header.html' %}
    {% endblock %}
  
  </style>
  <section class="py-5">
    <div class="container px-4 px-lg-5 my-5">
        <div class="row">
            <!-- 왼쪽 영역: Bar Chart, Doughnut Chart, WordCloud -->
            <div class="col-md-9">
                <div class="row gx-4 gx-lg-5 align-items-start"> <!-- align-items-start 추가 -->
                    <div class="col-md-12">
                        <!-- Bar Plot -->
                        <div style="border: 2px solid #3cb44b; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); padding: 10px; margin-bottom: 20px;">
                            <canvas id="myChart" width="400" height="200"></canvas>
                        </div>
                        <script>
                            const ctx = document.getElementById('myChart').getContext('2d');
                            const myChart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: {{ labels_json|safe }},
                                    datasets: [{
                                        label: '많이 사용된 재료들!',
                                        data: {{ data_json|safe }},
                                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                        borderColor: 'rgba(75, 192, 192, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });
                        </script>
                        <!-- Doughnut Chart -->
                        <div style="border: 2px solid #3cb44b; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); padding: 10px; margin-top: 20px;">
                            <h5 style="text-align: center; margin: 10px 0; font-weight: bold; top: 0; background-color: white; z-index: 10; font-family: 'Noto Sans KR', sans-serif; font-weight: bold; color: #3cb44b;">조리 소요 시간!</h5>
                            <canvas id="piChart" width="400" height="200"></canvas>
                        </div>
                        <script>
                            const ctx2 = document.getElementById('piChart').getContext('2d');
                            const piChart = new Chart(ctx2, {
                                type: 'doughnut',
                                data: {
                                    labels: {{ cook_time_label|safe }},
                                    datasets: [{
                                        label: '조리 소요 시간',
                                        data: {{ cook_time_data|safe }},
                                        backgroundColor: [
                                            'rgba(255, 99, 132, 0.2)',
                                            'rgba(54, 162, 235, 0.2)',
                                            'rgba(255, 206, 86, 0.2)',
                                            'rgba(75, 192, 192, 0.2)',
                                            'rgba(153, 102, 255, 0.2)',
                                            'rgba(255, 159, 64, 0.2)'
                                        ],
                                        borderColor: [
                                            'rgba(255, 99, 132, 1)',
                                            'rgba(54, 162, 235, 1)',
                                            'rgba(255, 206, 86, 1)',
                                            'rgba(75, 192, 192, 1)',
                                            'rgba(153, 102, 255, 1)',
                                            'rgba(255, 159, 64, 1)'
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            position: 'top' // 범례의 위치 설정
                                        }
                                    }
                                }
                            });
                        </script>

                        <!-- Word Cloud -->
                        <div id="wordcloud" style="height: 300px; width: 100%; margin-top: 20px; margin-bottom: 20px; border: 2px solid #3cb44b; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); overflow: hidden;"></div>
                        <script>
                            document.addEventListener('DOMContentLoaded', function() {
                                const ingredients = {{ ingredients_json|safe }};
                                
                                const frequencies = ingredients.map(ing => ing.frequency);
                                const maxFreq = Math.max(...frequencies);
                                const minFreq = Math.min(...frequencies);
                                
                                const linearScale = (val, minVal, maxVal, newMin, newMax) => {
                                    return newMin + (val - minVal) * (newMax - newMin) / (maxVal - minVal);
                                };

                                // 단어 목록을 생성하고 빈도를 스케일링합니다
                                const words = ingredients.map(ingredient => [
                                    ingredient.name,
                                    Math.max(5, Math.floor(linearScale(ingredient.frequency, minFreq, maxFreq, 10, 80))) // 크기 범위를 더 넓힘
                                ]);
    
                                console.log("Words for WordCloud:", words); // 디버깅을 위해 콘솔에 출력
    
                                // 형형색색의 팔레트 생성
                                const colors = ['#e6194B', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff', '#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1', '#000075', '#808080', '#ffffff', '#000000'];
                                
                                WordCloud(document.getElementById('wordcloud'), {
                                    list: words,
                                    gridSize: 10, // 글자 간격을 조금 더 조밀하게
                                    weightFactor: 2.2, // 빈도에 따른 크기 차이를 더 극적으로 조정
                                    fontFamily: 'Noto Sans KR, sans-serif',
                                    color: function() {
                                        return colors[Math.floor(Math.random() * colors.length)]; // 랜덤 색상
                                    },
                                    backgroundColor: 'white',
                                    rotateRatio: 0.5, // 회전 비율
                                    rotationSteps: 0, // 회전 각도
                                    drawOutOfBound: false, // 경계를 벗어나지 않도록 설정
                                    shrinkToFit: true, // 컨테이너에 맞추어 크기 조절
                                    minSize: 10
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
              <!-- 오른쪽 영역: 레시피 랭킹 -->
              <div class="col-md-3" style="height: 1205px; overflow-y: auto; position: relative; padding: 0px; border: 2px solid #3cb44b; border-radius: 15px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);">
                <h2 class="text-center mb-4" style="position: sticky; top: 0; background-color: white; z-index: 10; font-family: 'Noto Sans KR', sans-serif; font-weight: bold; color: #3cb44b; padding: 10px; border-bottom: 2px solid #3cb44b;">레시피 랭킹</h2>
                {% for recipe in recipes %}
                    <div class="small mb-3" style="font-weight: bold; font-size: 1.5rem; color: #333333; font-family: 'Noto Sans KR', sans-serif; padding: 5px;">
                      <a href="http://127.0.0.1:8000/dashboard/{{ forloop.counter|add:13 }}" style="color: #333333; text-decoration: none;">
                        {{ forloop.counter }}위: {{ recipe.recipe_title }}
                    </a>
                    </div>
                    <div class="text-center mb-3" style="padding: 10px;">
                        <img src="{{ recipe.image_url }}" alt="{{ recipe.recipe_title }}" style="width: 100%; height: auto; max-width: 250px; border: 1px solid #dddddd; border-radius: 10px; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
                    </div>
                    <div style="border-bottom: 1px solid #cccccc; margin: 0 20px;" class="mb-3"></div>
                {% endfor %}
            </div>
          </div>
      </div>
  </section>
  
    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p>
      </div>
    </footer>
  </body>
</html>